version: 2.1

jobs:
  build:
    docker:
      - image: google/cloud-sdk:latest

    steps:
      - checkout

      # Authenticate with Google Cloud using service account key
      - run:
          name: Authenticate with Google Cloud
          command: |
            echo $GCP_SERVICE_ACCOUNT_KEY 
            # | base64 --decode > ${HOME}/gcp-key.json
            # cat ${HOME}/gcp-key.json
      #       echo "export GOOGLE_APPLICATION_CREDENTIALS=${HOME}/gcp-key.json" >> $BASH_ENV
      #       source $BASH_ENV
      #       echo $GCP_SERVICE_ACCOUNT_KEY | base64 --decode | docker login -u _json_key --password-stdin https://us-east4-docker.pkg.dev


      # # Build Docker image
      # - run:
      #     name: Build Docker image
      #     command: |
      #       docker build -t gcr.io/$GCLOUD_PROJECT_ID/your_image_name:$CIRCLE_SHA1 .

      # # Push Docker image to Google Container Registry (GCR)
      # - run:
      #     name: Push Docker image to GCR
      #     command: |
      #       docker push gcr.io/$GCLOUD_PROJECT_ID/your_image_name:$CIRCLE_SHA1

workflows:
  version: 2
  build_and_push:
    jobs:
      - build:
          context: Rivet

